"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterChain=exports.isFormTag=exports.parseVModel=exports.getVModelEntrys=exports.hasVModel=void 0;var util_1=require("../../shared/util"),util_2=require("./util"),constants_1=require("../../shared/constants");function hasVModel(e){return util_2.hasVAttr(e,constants_1.DIRECT_PREFIX+"model")}function getInputType(e,t){return getInputProp({context:e,el:t,propName:"type"})||"text"}function getInputValue(e,t){return getInputProp({context:e,el:t,propName:"value"})}function getInputProp(e){var t=e.context,r=e.el,n=e.propName,e=r.getAttributeNames();if(e.includes(n))return r.getAttribute(n);if(e.includes(constants_1.DIRECT_PREFIX+"bind:"+n)){n=r.getAttribute(constants_1.DIRECT_PREFIX+"bind:"+n);return util_1.execExpression(t,n)}return""}function hasProp(e){var t=e.el,e=e.prop,t=t.getAttributeNames();return t.includes(e)||t.includes(constants_1.DIRECT_PREFIX+"bind:"+e)}function getVModelEntrys(e){var t=e.el,e=e.vAttrNames.filter(function(e){return-1!==e.indexOf(constants_1.DIRECT_PREFIX+"model")});if(!e.length)return null;e=e[e.length-1];return util_2.getDirectiveEntry(t,e)}function parseVModel(e){var t=e.context,r=e.el,n=e.vAttrNames,a=e.tagName,e=e.VNode,o=this,i=getVModelEntrys({el:r,vAttrNames:n});if(!i)return null;var s=util_1.execExpression(t,i.expression),n=getInputType(t,r),u=getInputValue(t,r);"input"===a?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(n)?u?"radio"===n?e.data.props.checked=s==u:"checkbox"===n&&(util_1.isArray(s)?e.data.props.checked=s.includes(u):e.data.props.checked=s==u):e.data.props.checked=s:e.data.props.value=s:"textarea"===a?e.data.props.value=s:"select"===a&&Array.from(r.querySelectorAll("option")).forEach(function(e){var t=e.value.trim();util_1.isArray(s)?s.includes(t)&&e.setAttribute("selected","selected"):t==s&&e.setAttribute("selected","selected")});t=i.modifiers.lazy;return"select"===a?e.data.on.change=function(e){e=e.target.selectedOptions;hasProp({el:r,prop:"multiple"})?util_1.isArray(s)&&(o.$dataProxy[i.expression]=Array.from(e).map(function(e){return filterChain(e.value,i)})):util_1.isArray(s)||(o.$dataProxy[i.expression]=filterChain(e[0].value,i))}:"input"===a?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(n)?u?"radio"===n?e.data.on.change=function(e){o.$dataProxy[i.expression]=e.target.checked?u:""}:"checkbox"===n&&(util_1.isArray(s)?e.data.on.change=function(e){e.target.checked?o.$dataProxy[i.expression].push(u):-1!==(e=o.$dataProxy[i.expression].indexOf(u))&&o.$dataProxy[i.expression].splice(e,1)}:e.data.on.change=function(e){o.$dataProxy[i.expression]=e.target.checked?u:""}):e.data.on.change=function(e){o.$dataProxy[i.expression]=e.target.checked}:t?e.data.on.change=function(e){o.$dataProxy[i.expression]=filterChain(e.target.value,i)}:e.data.on.input=function(e){o.$dataProxy[i.expression]=filterChain(e.target.value,i)}:t?e.data.on.change=function(e){o.$dataProxy[i.expression]=filterChain(e.target.value,i)}:e.data.on.input=function(e){o.$dataProxy[i.expression]=filterChain(e.target.value,i)},i}function isFormTag(e){return constants_1.FORM_CONTROL_BINDING_TAG_NAMES.includes(e)}function filterChain(e,t){var r=e;return[{condition:t.modifiers.trim,handler:function(e){return e.trim()}},{condition:t.modifiers.number,handler:function(e){return Number(e)}}].forEach(function(e){var t=e.condition,e=e.handler;t&&(r=e(r))}),r}exports.hasVModel=hasVModel,exports.getVModelEntrys=getVModelEntrys,exports.parseVModel=parseVModel,exports.isFormTag=isFormTag,exports.filterChain=filterChain;
//# sourceMappingURL=model.js.map
