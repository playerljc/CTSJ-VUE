"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.iteratorVFor=exports.parseVFor=exports.hasVFor=void 0;var uuid_1=__importDefault(require("../../shared/uuid")),util_1=require("./util"),regexp_1=require("../../shared/regexp"),constants_1=require("../../shared/constants"),util_2=require("../../shared/util");function hasVFor(t){return util_1.hasVAttr(t,constants_1.DIRECT_PREFIX+"for")}function parseVFor(t){var e=t.context,r=t.el,i=t.vAttrNames,s=t.renderFun,t=r.getAttribute(constants_1.GROUP_KEY_NAME);r.hasAttribute(constants_1.GROUP_KEY_NAME)&&t||(t=uuid_1.default(),r.setAttribute(constants_1.GROUP_KEY_NAME,t));i=i.find(function(t){return-1!==t.indexOf(constants_1.DIRECT_PREFIX+"for")}),i=r.getAttribute(i).split(regexp_1.EMPTY_SPLIT);if(2!==i.length)return null;var n=i[0].trim(),i=i[1].trim(),o=[],u=util_2.execExpression(e,i);if(util_2.isObject(u)){var a,_=0;for(a in u){var l=iteratorVFor.call(this,{context:e,el:r,itItemStr:n,itItemObj:u[a],renderFun:s},_++);util_2.isArray(l)?o=o.concat(l):util_2.isObject(l)&&o.push(l)}}else if(util_2.isArray(u))for(var c=0;c<u.length;c++){l=iteratorVFor.call(this,{context:e,el:r,itItemStr:n,itItemObj:u[c],renderFun:s},c);util_2.isArray(l)?o=o.concat(l):util_2.isObject(l)&&o.push(l)}for(var p=this.componentsMap.keys(),f=this;p.length;)!function(){var e=p.pop();o.some(function(t){return t.key===e})||f.componentsMap.delete(e)}();return o}function iteratorVFor(t,e){var r=t.context,i=t.el,s=t.itItemStr,n=t.itItemObj,o=t.renderFun;s.startsWith("(")&&s.endsWith(")")&&-1!==(s=s.substring(1,s.length-1).trim()).indexOf(",")?(r[(t=s.split(",").map(function(t){return t.trim()}))[0].trim()]=n,r[t[1].trim()]=e):r[s]=n;var u,a,s=i.getAttributeNames(),n=i.getAttribute(constants_1.GROUP_KEY_NAME);-1!==s.indexOf(constants_1.DIRECT_PREFIX+"bind:key")?(u=constants_1.DIRECT_PREFIX+"bind:key",a=i.getAttribute(u),i.setAttribute(u,"'"+n+"' + '("+util_2.execExpression(r,a)+")'")):s.indexOf("key")?(u="key",a=i.getAttribute(u),i.setAttribute(u,n+"("+a+")")):i.setAttribute("key",""+n+e);i=i.cloneNode(!0);return i.removeAttribute(constants_1.DIRECT_PREFIX+"for"),o.call(this,r,i)}exports.hasVFor=hasVFor,exports.parseVFor=parseVFor,exports.iteratorVFor=iteratorVFor;
//# sourceMappingURL=for.js.map
