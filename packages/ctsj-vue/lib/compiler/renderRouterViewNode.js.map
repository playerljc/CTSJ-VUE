{"version":3,"file":"renderRouterViewNode.js","sources":["compiler/renderRouterViewNode.js"],"sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.renderRouterViewNode = void 0;\r\nvar vue_util_1 = require(\"@ctsj/vue-util\");\r\nvar util_1 = require(\"./directives/util\");\r\nvar for_1 = require(\"./directives/for\");\r\nvar if_1 = require(\"./directives/if\");\r\nvar else_1 = require(\"./directives/else\");\r\nvar else_if_1 = require(\"./directives/else-if\");\r\nvar util_2 = require(\"../core/util\");\r\nvar util_3 = require(\"../core/component/util\");\r\nvar register_1 = require(\"../core/component/register\");\r\nvar renderComponentNode_1 = require(\"./renderComponentNode\");\r\n/**\r\n * renderRouterViewNode - 渲染router-view元素\r\n * @param context - Object 上下文对象\r\n * @param el - HtmlElement 元素\r\n * @param parentVNode VNode\r\n * @param parentElement HtmlElement\r\n * @return VNode\r\n */\r\nfunction renderRouterViewNode(_a) {\r\n    var context = _a.context, el = _a.el, parentVNode = _a.parentVNode, parentElement = _a.parentElement;\r\n    var vAttrNames = util_1.getVAttrNames(el);\r\n    var key;\r\n    if (vAttrNames.length) {\r\n        // 解析el的v-for标签\r\n        if (for_1.hasVFor(vAttrNames)) {\r\n            // parse v-for\r\n            return for_1.parseVFor.call(this, \r\n            // 如果context是this.$dataProxy则需要重新创建新的context(上下文)，因为一个v-for就是一个新的上下文环境，因为v-for会有新的变量放入到this中\r\n            {\r\n                context: context,\r\n                // context === this.$dataProxy ? createContext.call(this, this.$dataProxy) : context,\r\n                el: el,\r\n                parentVNode: parentVNode,\r\n                vAttrNames: vAttrNames,\r\n                renderFun: renderRouterViewNode,\r\n            });\r\n        }\r\n        // 这个key属性可能是v-bind:key=，也可能是key=\r\n        key = util_1.getKey.call(this, { context: context, el: el });\r\n        // 解析v-if\r\n        if (if_1.hasVIf(vAttrNames)) {\r\n            // parse v-if\r\n            var display = if_1.parseVIf.call(this, { context: context, el: el, vAttrNames: vAttrNames });\r\n            if (!display) {\r\n                // 不显示这个节点\r\n                if (key) {\r\n                    // 有key属性则在componentsMap中删除这个组件的引用\r\n                    this.componentsMap.delete(key);\r\n                }\r\n                return null;\r\n            }\r\n        }\r\n        // 解析v-else\r\n        if (else_1.hasVElse(vAttrNames)) {\r\n            // 合理性判断\r\n            // 如果合理则进行计算\r\n            var entry = else_1.parseVElse.call(this, { context: context, el: el, parentElement: parentElement });\r\n            if (!entry.valid) {\r\n                if (key) {\r\n                    // 有key属性则在componentsMap中删除这个组件的引用\r\n                    this.componentsMap.delete(key);\r\n                }\r\n                return null;\r\n            }\r\n            if (!entry.result) {\r\n                if (key) {\r\n                    // 有key属性则在componentsMap中删除这个组件的引用\r\n                    this.componentsMap.delete(key);\r\n                }\r\n                return null;\r\n            }\r\n        }\r\n        // 解析v-else-if\r\n        if (else_if_1.hasVElseIf(vAttrNames)) {\r\n            // 合理性判断\r\n            // 如果合理则进行计算\r\n            var entry = else_if_1.parseVElseIf.call(this, { context: context, el: el, parentElement: parentElement });\r\n            if (!entry.valid) {\r\n                if (key) {\r\n                    // 有key属性则在componentsMap中删除这个组件的引用\r\n                    this.componentsMap.delete(key);\r\n                }\r\n                return null;\r\n            }\r\n            if (!entry.result) {\r\n                if (key) {\r\n                    // 有key属性则在componentsMap中删除这个组件的引用\r\n                    this.componentsMap.delete(key);\r\n                }\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n    // 这个key属性可能是v-bind:key=，也可能是key=\r\n    key = util_1.getKey.call({ context: context, el: el });\r\n    // 根据路由配置获取component的组件，然后根据component反查tagName\r\n    // 创建tagName的元素\r\n    var matchResult;\r\n    // 如果是vue实例\r\n    if (util_2.isVueInstance(this)) {\r\n        //  得到routes的配置数据\r\n        matchResult = this.$router.$getComponentIsVueIns();\r\n    }\r\n    // 如果是组件\r\n    else if (util_3.isComponentInstance(this)) {\r\n        //  得到浏览器的pathname\r\n        //  组件的实例中需要有路由的配置项信息(重点)\r\n        matchResult = this.$router.$getComponentIsComIns(this.$matchRoute);\r\n    }\r\n    // 如果没有匹配的路由说明连*都没写\r\n    if (!matchResult)\r\n        return null;\r\n    // el没有key属性\r\n    if (vue_util_1.isEmpty(key)) {\r\n        key = vue_util_1.uuid();\r\n        el.setAttribute('key', key);\r\n    }\r\n    // 结构matchResult\r\n    var component = matchResult.component, detail = matchResult.detail, route = matchResult.route;\r\n    // 初始化$route对象\r\n    this.$route = __assign({}, detail);\r\n    // 根据component去全局注册中寻找组件的名字\r\n    var comName = register_1.getNameByComponentInGlobal(component);\r\n    // 根据注册的名字创建一个el元素并赋值key属性\r\n    var comEl = document.createElement(comName);\r\n    comEl.setAttribute('key', key);\r\n    // 调用renderComponentNode方法\r\n    return renderComponentNode_1.renderComponentNode.call(this, {\r\n        context: context,\r\n        el: comEl,\r\n        parentVNode: parentVNode,\r\n        parentElement: parentElement,\r\n        route: route,\r\n    });\r\n}\r\nexports.renderRouterViewNode = renderRouterViewNode;\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","renderRouterViewNode","vue_util_1","require","util_1","for_1","if_1","else_1","else_if_1","util_2","util_3","register_1","renderComponentNode_1","_a","context","el","parentVNode","parentElement","vAttrNames","getVAttrNames","hasVFor","parseVFor","renderFun","key","getKey","hasVIf","parseVIf","componentsMap","delete","hasVElse","entry","parseVElse","valid","result","hasVElseIf","parseVElseIf","isVueInstance","matchResult","$router","$getComponentIsVueIns","isComponentInstance","$getComponentIsComIns","$matchRoute","isEmpty","uuid","setAttribute","component","detail","route","$route","comName","getNameByComponentInGlobal","comEl","document","createElement","renderComponentNode"],"mappings":"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"}