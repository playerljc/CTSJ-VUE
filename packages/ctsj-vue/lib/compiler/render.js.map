{"version":3,"file":"render.js","sources":["compiler/render.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.render = void 0;\r\n// render\r\nvar vue_util_1 = require(\"@ctsj/vue-util\");\r\nvar util_1 = require(\"../core/util\");\r\nvar util_2 = require(\"../shared/util\");\r\nvar renderUtil_1 = require(\"./renderUtil\");\r\nvar vdom_1 = require(\"../core/vdom\");\r\nvar constants_1 = require(\"../shared/constants\");\r\n/**\r\n * render - Vue实例的渲染\r\n * @param el - HtmlElement\r\n * @param isMount - boolean 是否是挂载阶段\r\n */\r\nfunction render(el, isMount) {\r\n    var self = this;\r\n    // 进行loopRender\r\n    // vue实例代表的vnode\r\n    var startTime = new Date().getTime();\r\n    var vnode = renderUtil_1.renderLoop.call(this, {\r\n        context: {},\r\n        el: this.templateEl,\r\n        parentVNode: null,\r\n        parentElement: null,\r\n    });\r\n    var endTime = new Date().getTime();\r\n    util_2.log(\"render\\u6240\\u7528\\u65F6\\u95F4\" + (endTime - startTime) / 1000 + \"m\");\r\n    if (!vnode)\r\n        return false;\r\n    var hooks = vnode.data.hook;\r\n    // vnode的hook设置\r\n    vnode.data.hook = {\r\n        /**\r\n         * 一个vnode已添加\r\n         * @param vnode\r\n         */\r\n        init: function (curVNode) {\r\n            if (vue_util_1.isFunction(hooks.init)) {\r\n                hooks.init.apply(hooks, Array.from(arguments));\r\n            }\r\n            if (curVNode === vnode) {\r\n                util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[1]);\r\n            }\r\n        },\r\n        /**\r\n         * 已基于vnode创建了一个DOM元素\r\n         * @param emptyVnode\r\n         * @param vnode\r\n         */\r\n        create: function (emptyVnode, curVNode) {\r\n            if (vue_util_1.isFunction(hooks.create)) {\r\n                hooks.create.apply(hooks, Array.from(arguments));\r\n            }\r\n            if (curVNode === vnode) {\r\n                util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[2]);\r\n            }\r\n        },\r\n        // /**\r\n        //  * insert - 元素已插入DOM\r\n        //  * @param vnode\r\n        //  */\r\n        // insert: (vnode) => {\r\n        //   // ------ mount\r\n        //   log(33333333333);\r\n        //   triggerLifecycle.call(self, LIFECYCLE_HOOKS[3]);\r\n        // },\r\n        /**\r\n         * 元素即将被修补\r\n         */\r\n        prepatch: function (oldVNode, newVNode) {\r\n            if (vue_util_1.isFunction(hooks.prepatch)) {\r\n                hooks.prepatch.apply(hooks, Array.from(arguments));\r\n            }\r\n            if (newVNode === vnode) {\r\n                // beforeUpdate\r\n                util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[4]);\r\n            }\r\n        },\r\n        /**\r\n         * 元素已被修补\r\n         */\r\n        postpatch: function (oldVNode, newVNode) {\r\n            if (vue_util_1.isFunction(hooks.postpatch)) {\r\n                hooks.postpatch.apply(hooks, Array.from(arguments));\r\n            }\r\n            if (newVNode === vnode) {\r\n                // update\r\n                util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[5]);\r\n            }\r\n        },\r\n        /**\r\n         * 一个元素被直接或间接删除\r\n         */\r\n        destroy: function (curVNode) {\r\n            if (vue_util_1.isFunction(hooks.destroy)) {\r\n                hooks.destroy.apply(hooks, Array.from(arguments));\r\n            }\r\n            // vue实例销毁的时候需要调用router的销毁,执行router的销毁操作\r\n            self.$router.$destory();\r\n            if (curVNode === vnode) {\r\n                util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[7]);\r\n            }\r\n        },\r\n    };\r\n    // 挂载\r\n    if (isMount) {\r\n        // 需要赋值$preVNode\r\n        // this.$preVNode = vnode;\r\n        this.$preVNode = vdom_1.patch(el, vnode);\r\n        // ------ mount\r\n        util_1.triggerLifecycle.call(self, constants_1.LIFECYCLE_HOOKS[3]);\r\n    }\r\n    // 更新\r\n    else {\r\n        if (!this.$preVNode) {\r\n            this.$preVNode = vnode;\r\n        }\r\n        var startTime_1 = new Date().getTime();\r\n        this.$preVNode = vdom_1.patch(this.$preVNode, vnode);\r\n        var endTime_1 = new Date().getTime();\r\n        util_2.log(\"patch\\u6240\\u7528\\u65F6\\u95F4\" + (endTime_1 - startTime_1) / 1000 + \"m\");\r\n    }\r\n    return true;\r\n}\r\nexports.render = render;\r\n"],"names":["Object","defineProperty","exports","value","render","vue_util_1","require","util_1","util_2","renderUtil_1","vdom_1","constants_1","el","isMount","self","this","startTime","Date","getTime","vnode","renderLoop","call","context","templateEl","parentVNode","parentElement","endTime","log","hooks","data","hook","init","curVNode","isFunction","apply","Array","from","arguments","triggerLifecycle","LIFECYCLE_HOOKS","create","emptyVnode","prepatch","oldVNode","newVNode","postpatch","destroy","$router","$destory","$preVNode","patch","startTime_1","endTime_1"],"mappings":"aACAA,OAAOC,eAAeC,QAAS,aAAc,CAAEC,OAAO,IACtDD,QAAQE,YAAS,EAEjB,IAAIC,WAAaC,QAAQ,kBACrBC,OAASD,QAAQ,gBACjBE,OAASF,QAAQ,kBACjBG,aAAeH,QAAQ,gBACvBI,OAASJ,QAAQ,gBACjBK,YAAcL,QAAQ,uBAM1B,SAASF,OAAOQ,EAAIC,GAChB,IAAIC,EAAOC,KAGPC,GAAY,IAAIC,MAAOC,UACvBC,EAAQV,aAAaW,WAAWC,KAAKN,KAAM,CAC3CO,QAAS,GACTV,GAAIG,KAAKQ,WACTC,YAAa,KACbC,cAAe,OAEfC,GAAU,IAAIT,MAAOC,UAEzB,GADAV,OAAOmB,IAAI,cAAoCD,EAAUV,GAAa,IAAO,MACxEG,EACD,OAAO,EACX,IAAIS,EAAQT,EAAMU,KAAKC,KA6FvB,OA3FAX,EAAMU,KAAKC,KAAO,CAKdC,KAAM,SAAUC,GACR3B,WAAW4B,WAAWL,EAAMG,OAC5BH,EAAMG,KAAKG,MAAMN,EAAOO,MAAMC,KAAKC,YAEnCL,IAAab,GACbZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,KAQvEC,OAAQ,SAAUC,EAAYT,GACtB3B,WAAW4B,WAAWL,EAAMY,SAC5BZ,EAAMY,OAAON,MAAMN,EAAOO,MAAMC,KAAKC,YAErCL,IAAab,GACbZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,KAevEG,SAAU,SAAUC,EAAUC,GACtBvC,WAAW4B,WAAWL,EAAMc,WAC5Bd,EAAMc,SAASR,MAAMN,EAAOO,MAAMC,KAAKC,YAEvCO,IAAazB,GAEbZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,KAMvEM,UAAW,SAAUF,EAAUC,GACvBvC,WAAW4B,WAAWL,EAAMiB,YAC5BjB,EAAMiB,UAAUX,MAAMN,EAAOO,MAAMC,KAAKC,YAExCO,IAAazB,GAEbZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,KAMvEO,QAAS,SAAUd,GACX3B,WAAW4B,WAAWL,EAAMkB,UAC5BlB,EAAMkB,QAAQZ,MAAMN,EAAOO,MAAMC,KAAKC,YAG1CvB,EAAKiC,QAAQC,WACThB,IAAab,GACbZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,MAKvE1B,GAGAE,KAAKkC,UAAYvC,OAAOwC,MAAMtC,EAAIO,GAElCZ,OAAO+B,iBAAiBjB,KAAKP,EAAMH,YAAY4B,gBAAgB,MAI1DxB,KAAKkC,YACNlC,KAAKkC,UAAY9B,GAEjBgC,GAAc,IAAIlC,MAAOC,UAC7BH,KAAKkC,UAAYvC,OAAOwC,MAAMnC,KAAKkC,UAAW9B,GAC1CiC,GAAY,IAAInC,MAAOC,UAC3BV,OAAOmB,IAAI,aAAmCyB,EAAYD,GAAe,IAAO,OAE7E,EAEXjD,QAAQE,OAASA"}