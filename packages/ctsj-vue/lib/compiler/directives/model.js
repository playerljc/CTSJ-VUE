"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterChain=exports.isFormTag=exports.parseOption=exports.parseVModel=exports.getVModelEntrys=exports.hasVModel=void 0;var util_1=require("../../shared/util"),util_2=require("./util"),constants_1=require("../../shared/constants");function hasVModel(t){return util_2.hasVAttr(t,constants_1.DIRECT_PREFIX+"model")}function getInputType(t,e){return getInputProp.call(this,{context:t,el:e,propName:"type"})||"text"}function getInputValue(t,e){return getInputProp.call(this,{context:t,el:e,propName:"value"})}function getInputProp(t){var e=t.context,n=t.el,r=t.propName,t=n.getAttributeNames();if(t.includes(r))return n.getAttribute(r);if(t.includes(constants_1.DIRECT_PREFIX+"bind:"+r)){r=n.getAttribute(constants_1.DIRECT_PREFIX+"bind:"+r);return util_1.execExpression.call(this,e,r)}return""}function hasProp(t){var e=t.el,t=t.prop,e=e.getAttributeNames();return e.includes(t)||e.includes(constants_1.DIRECT_PREFIX+"bind:"+t)}function getVModelEntrys(t){var e=t.el,t=t.vAttrNames.filter(function(t){return-1!==t.indexOf(constants_1.DIRECT_PREFIX+"model")});if(!t.length)return null;t=t[t.length-1];return util_2.getDirectiveEntry(e,t)}function parseVModel(t){var e=t.context,n=t.el,r=t.vAttrNames,a=t.tagName,t=t.VNode,o=this,i=getVModelEntrys({el:n,vAttrNames:r});if(!i)return null;var s=util_1.execExpression.call(this,e,i.expression),r=getInputType.call(this,e,n),c=getInputValue.call(this,e,n);"input"===a?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(r)?c?"radio"===r?t.data.props.checked=s==c:"checkbox"===r&&(util_1.isArray(s)?t.data.props.checked=s.includes(c):t.data.props.checked=s==c):t.data.props.checked=s:t.data.props.value=s:"textarea"===a&&(t.data.props.value=s);e=i.modifiers.lazy;return"select"===a?t.data.on.change=function(e){util_1.createExecutionContext.call(o,o,function(){var t=e.target.selectedOptions;hasProp({el:n,prop:"multiple"})?util_1.isArray(s)&&(o.$dataProxy[i.expression]=Array.from(t).map(function(t){return filterChain(t.value,i)})):util_1.isArray(s)||(o.$dataProxy[i.expression]=filterChain(t[0].value,i))})}:"input"===a?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(r)?c?"radio"===r?t.data.on.change=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=t.target.checked?c:""})}:"checkbox"===r&&(util_1.isArray(s)?t.data.on.change=function(e){util_1.createExecutionContext.call(o,o,function(){var t;e.target.checked?o.$dataProxy[i.expression].push(c):-1!==(t=o.$dataProxy[i.expression].indexOf(c))&&o.$dataProxy[i.expression].splice(t,1)})}:t.data.on.change=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=t.target.checked?c:""})}):t.data.on.change=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=t.target.checked})}:e?t.data.on.change=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=filterChain(t.target.value,i)})}:t.data.on.input=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=filterChain(t.target.value,i)})}:e?t.data.on.change=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=filterChain(t.target.value,i)})}:t.data.on.input=function(t){util_1.createExecutionContext.call(o,o,function(){o.$dataProxy[i.expression]=filterChain(t.target.value,i)})},i}function parseOption(t){var e=t.context,n=t.VNode,t=t.parentElement,e=util_1.execExpression.call(this,e,t.getAttribute(constants_1.DIRECT_PREFIX+"model")),t=n.data.props.value;util_1.isArray(e)?e.includes(t)&&(n.data.props.selected="selected"):t==e&&(n.data.props.selected="selected")}function isFormTag(t){return constants_1.FORM_CONTROL_BINDING_TAG_NAMES.includes(t)}function filterChain(t,e){var n=t;return[{condition:e.modifiers.trim,handler:function(t){return t.trim()}},{condition:e.modifiers.number,handler:function(t){return Number(t)}}].forEach(function(t){var e=t.condition,t=t.handler;e&&(n=t(n))}),n}exports.hasVModel=hasVModel,exports.getVModelEntrys=getVModelEntrys,exports.parseVModel=parseVModel,exports.parseOption=parseOption,exports.isFormTag=isFormTag,exports.filterChain=filterChain;
//# sourceMappingURL=model.js.map
