"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterChain=exports.isFormTag=exports.parseOption=exports.parseVModel=exports.getVModelEntrys=exports.hasVModel=void 0;var vue_util_1=require("@ctsj/vue-util"),util_1=require("../../shared/util"),util_2=require("./util"),constants_1=require("../../shared/constants");function hasVModel(t){return util_2.hasVAttr(t,constants_1.DIRECT_PREFIX+"model")}function getInputType(t,e){return getInputProp.call(this,{context:t,el:e,propName:"type"})||"text"}function getInputValue(t,e){return getInputProp.call(this,{context:t,el:e,propName:"value"})}function getInputProp(t){var e=t.context,n=t.el,a=t.propName,t=n.getAttributeNames();if(t.includes(a))return n.getAttribute(a);if(t.includes(constants_1.DIRECT_PREFIX+"bind:"+a)){a=n.getAttribute(constants_1.DIRECT_PREFIX+"bind:"+a);return util_1.execExpression.call(this,e,a)}return""}function hasProp(t){var e=t.el,t=t.prop,e=e.getAttributeNames();return e.includes(t)||e.includes(constants_1.DIRECT_PREFIX+"bind:"+t)}function getVModelEntrys(t){var e=t.el,t=t.vAttrNames.filter(function(t){return-1!==t.indexOf(constants_1.DIRECT_PREFIX+"model")});if(!t.length)return null;t=t[t.length-1];return util_2.getDirectiveEntry(e,t)}function parseVModel(t){var e=t.context,n=t.el,a=t.vAttrNames,i=t.tagName,t=t.VNode,r=this,o=getVModelEntrys({el:n,vAttrNames:a});if(!o)return null;var l=util_1.execExpression.call(this,e,o.expression),a=getInputType.call(this,e,n),u=getInputValue.call(this,e,n);"input"===i?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(a)?u?"radio"===a?t.data.props.checked=l==u:"checkbox"===a&&(vue_util_1.isArray(l)?t.data.props.checked=l.includes(u):t.data.props.checked=l==u):t.data.props.checked=l:t.data.props.value=l:"textarea"===i&&(t.data.props.value=l);e=o.modifiers.lazy;return"select"===i?t.data.on.change=function(e){util_1.createExecutionContext.call(r,r,function(){var t=e.target.selectedOptions;hasProp({el:n,prop:"multiple"})?vue_util_1.isArray(l)&&vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:Array.from(t).map(function(t){return filterChain(t.value,o)})}):vue_util_1.isArray(l)||vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:filterChain(t[0].value,o)})})}:"input"===i?constants_1.FORM_CONTROL_CHECKED_TAG_NAMES.includes(a)?u?"radio"===a?t.data.on.change=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:t.target.checked?u:""})})}:"checkbox"===a&&(vue_util_1.isArray(l)?t.data.on.change=function(n){util_1.createExecutionContext.call(r,r,function(){var t,e=vue_util_1.getObjectByChainStr({obj:r.$dataProxy,chainStr:o.expression});n.target.checked?e.push(u):-1!==(t=e.indexOf(u))&&e.splice(t,1)})}:t.data.on.change=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:t.target.checked?u:""})})}):t.data.on.change=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:t.target.checked})})}:e?t.data.on.change=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:filterChain(t.target.value,o)})})}:t.data.on.input=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:filterChain(t.target.value,o)})})}:e?t.data.on.change=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:filterChain(t.target.value,o)})})}:t.data.on.input=function(t){util_1.createExecutionContext.call(r,r,function(){vue_util_1.chainCallAssignment({obj:r.$dataProxy,chainStr:o.expression,value:filterChain(t.target.value,o)})})},o}function parseOption(t){var e=t.context,n=t.VNode,t=t.parentElement,e=util_1.execExpression.call(this,e,t.getAttribute(constants_1.DIRECT_PREFIX+"model")),t=n.data.props.value;vue_util_1.isArray(e)?e.includes(t)&&(n.data.props.selected="selected"):t==e&&(n.data.props.selected="selected")}function isFormTag(t){return constants_1.FORM_CONTROL_BINDING_TAG_NAMES.includes(t)}function filterChain(t,e){var n=t;return[{condition:e.modifiers.trim,handler:function(t){return t.trim()}},{condition:e.modifiers.number,handler:function(t){return Number(t)}}].forEach(function(t){var e=t.condition,t=t.handler;e&&(n=t(n))}),n}exports.hasVModel=hasVModel,exports.getVModelEntrys=getVModelEntrys,exports.parseVModel=parseVModel,exports.parseOption=parseOption,exports.isFormTag=isFormTag,exports.filterChain=filterChain;
//# sourceMappingURL=model.js.map
