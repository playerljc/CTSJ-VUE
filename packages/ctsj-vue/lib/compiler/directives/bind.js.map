{"version":3,"file":"bind.js","sources":["compiler/directives/bind.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.parseVBind = exports.getVBindEntrys = exports.hasVBind = void 0;\r\nvar proxy_1 = require(\"../../core/proxy\");\r\nvar util_1 = require(\"../../core/component/util\");\r\nvar util_2 = require(\"./util\");\r\nvar constants_1 = require(\"../../shared/constants\");\r\nvar util_3 = require(\"../../shared/util\");\r\n/**\r\n * hasVBind - 是否存在v-bind属性\r\n * @param attrNames - Array 所有的指令属性\r\n * @return {boolean}\r\n */\r\nfunction hasVBind(attrNames) {\r\n    return util_2.hasVAttr(attrNames, constants_1.DIRECT_PREFIX + \"bind\");\r\n}\r\nexports.hasVBind = hasVBind;\r\n/**\r\n * getVBindEntrys - 获取所有v-bind属性的实体集合\r\n * @param context - Object 上下文对象\r\n * @param el - HtmlElement\r\n * @param vAttrNames - Array 所有指令属性的集合\r\n * @return Array\r\n */\r\nfunction getVBindEntrys(_a) {\r\n    var _this = this;\r\n    var context = _a.context, el = _a.el, vAttrNames = _a.vAttrNames;\r\n    // 获取所有v-bind标签\r\n    var bindAttrs = vAttrNames.filter(function (n) { return n.indexOf(constants_1.DIRECT_PREFIX + \"bind\") !== -1; });\r\n    var cloneEl = document.createElement(el.tagName);\r\n    var resultAttrs = [];\r\n    bindAttrs.forEach(function (bindAttr) {\r\n        // 如果bindAttr是v-bind对象绑定\r\n        if (bindAttr === constants_1.DIRECT_PREFIX + \"bind\") {\r\n            var attrValue_1 = el.getAttribute(bindAttr);\r\n            var value = util_3.execExpression.call(_this, context, attrValue_1);\r\n            // 如果这个值是Object\r\n            if (util_3.isObject(value)) {\r\n                Object.keys(value).forEach(function (key) {\r\n                    if (proxy_1.isProxyProperty(key)) {\r\n                        // key是驼峰命名的需要转换成xxx-xxx形式\r\n                        var bindKey = constants_1.DIRECT_PREFIX + \"bind:\" + util_1.pascalCaseToKebabCase(key);\r\n                        cloneEl.setAttribute(bindKey, attrValue_1 + \".\" + key);\r\n                        resultAttrs.push(bindKey);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        // bindAttr是v-bind:xxx\r\n        else {\r\n            cloneEl.setAttribute(bindAttr, el.getAttribute(bindAttr));\r\n            resultAttrs.push(bindAttr);\r\n        }\r\n    });\r\n    return resultAttrs.map(function (attrName) {\r\n        // 获取一个v-bind的实体\r\n        var entry = util_2.getDirectiveEntry(cloneEl, attrName);\r\n        // arg是class或者是style\r\n        if (entry.arg === 'class' || entry.arg === 'style') {\r\n            // arg是class\r\n            if (entry.arg === 'class') {\r\n                if (entry.expression.startsWith('{') && entry.expression.endsWith('}')) {\r\n                    // { active: isActive, 'text-danger': hasError }\r\n                    entry.expression = \"Object(\" + entry.expression + \")\";\r\n                }\r\n                // <div v-bind:class=\"classObject\"></div>\r\n                // [activeClass, errorClass]\r\n                entry.value = util_3.execExpression.call(_this, context, entry.expression);\r\n                if (util_3.isArray(entry.value)) {\r\n                    var classNames = entry.value;\r\n                    entry.value = {};\r\n                    classNames.forEach(function (className) {\r\n                        entry.value[className] = true;\r\n                    });\r\n                }\r\n            }\r\n            // arg是style\r\n            if (entry.arg === 'style') {\r\n                if (entry.expression.indexOf('{') === 0 &&\r\n                    entry.expression.lastIndexOf('}') === entry.expression.length - 1) {\r\n                    entry.expression = \"Object(\" + entry.expression + \")\";\r\n                }\r\n                entry.value = util_3.execExpression.call(_this, context, entry.expression);\r\n            }\r\n        }\r\n        else if (entry.arg) {\r\n            // 其他的情况\r\n            entry.value = util_3.execExpression.call(_this, context, entry.expression);\r\n        }\r\n        return entry;\r\n    });\r\n}\r\nexports.getVBindEntrys = getVBindEntrys;\r\n/**\r\n * parseVBind - 解析v-bind\r\n * @param context - Object 上下文对象\r\n * @param el - HtmlElement\r\n * @param vAttrNames - Array 所有指令的集合\r\n * @param VNode - VNode 当前的VNode节点\r\n * @return {Object}\r\n */\r\nfunction parseVBind(_a) {\r\n    var context = _a.context, el = _a.el, vAttrNames = _a.vAttrNames, VNode = _a.VNode;\r\n    var self = this;\r\n    var entrys = getVBindEntrys.call(this, { context: context, el: el, vAttrNames: vAttrNames });\r\n    entrys.forEach(function (entry) {\r\n        // key属性\r\n        if (entry.arg === 'key') {\r\n            VNode.key = entry.value;\r\n        }\r\n        // ref属性\r\n        if (entry.arg === 'ref') {\r\n            // ref属性不放入到VNode中\r\n            // 创建当前VNode的hook\r\n            Object.assign(VNode.data.hook, {\r\n                /**\r\n                 * insert - 元素已插入DOM\r\n                 * @param vnode\r\n                 */\r\n                insert: function (vnode) {\r\n                    // 保存HtmlElement的el到$refs中\r\n                    self.$refs[entry.value] = vnode.elm;\r\n                },\r\n            });\r\n        }\r\n        // class属性\r\n        else if (entry.arg === 'class') {\r\n            var value_1 = {};\r\n            Object.keys(entry.value).forEach(function (key) {\r\n                if (proxy_1.isProxyProperty(key)) {\r\n                    value_1[key] = entry.value[key];\r\n                }\r\n            });\r\n            Object.assign(VNode.data.class, value_1);\r\n        }\r\n        // style属性\r\n        else if (entry.arg === 'style') {\r\n            Object.assign(VNode.data.style, entry.value);\r\n        }\r\n        // data-*属性\r\n        else if (entry.arg.startsWith('data-')) {\r\n            VNode.data.dataset[util_3.toCamelCase(entry.arg.substring('data-'.length))] = entry.value;\r\n        }\r\n        // 其他的属性\r\n        else {\r\n            VNode.data.props[entry.arg] = entry.value;\r\n        }\r\n    });\r\n    return entrys;\r\n}\r\nexports.parseVBind = parseVBind;\r\n"],"names":["Object","defineProperty","exports","value","parseVBind","getVBindEntrys","hasVBind","proxy_1","require","util_1","util_2","constants_1","util_3","attrNames","hasVAttr","DIRECT_PREFIX","_a","_this","this","context","el","bindAttrs","vAttrNames","filter","n","indexOf","cloneEl","document","createElement","tagName","resultAttrs","forEach","bindAttr","attrValue_1","getAttribute","execExpression","call","isObject","keys","key","bindKey","isProxyProperty","pascalCaseToKebabCase","setAttribute","push","map","attrName","entry","getDirectiveEntry","arg","expression","startsWith","endsWith","isArray","classNames","className","lastIndexOf","length","VNode","self","entrys","value_1","assign","data","hook","insert","vnode","$refs","elm","class","style","dataset","toCamelCase","substring","props"],"mappings":"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"}