"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.iteratorVFor=exports.parseVFor=exports.hasVFor=void 0;var vue_util_1=require("@ctsj/vue-util"),util_1=require("./util"),regexp_1=require("../../shared/regexp"),constants_1=require("../../shared/constants"),util_2=require("../../shared/util"),proxy_1=require("../../core/proxy"),ITERATOR_CHAIN=[{condition:function(t){return vue_util_1.isObject(t)},handler:iteratorObj},{condition:function(t){return vue_util_1.isArray(t)},handler:iteratorArray},{condition:function(t){return vue_util_1.isNumber(t)},handler:iteratorNumber}];function iteratorObj(t){var e,r,n=t.val,i=t.context,o=t.el,u=t.parentVNode,a=t.itItemStr,s=t.renderFun,l=t.VNodes,c=0;for(e in n)proxy_1.isProxyProperty(e)&&(r=iteratorVFor.call(this,{context:proxy_1.createContext(i),el:o,parentVNode:u,itItemStr:a,itItemObj:n[e],renderFun:s},e,c),vue_util_1.isArray(r)?l=l.concat(r):vue_util_1.isObject(r)&&l.push(r),c++);return l}function iteratorArray(t){for(var e=t.val,r=t.context,n=t.el,i=t.parentVNode,o=t.itItemStr,u=t.renderFun,a=t.VNodes,s=0;s<e.length;s++){var l=iteratorVFor.call(this,{context:proxy_1.createContext(r),el:n,parentVNode:i,itItemStr:o,itItemObj:e[s],renderFun:u},null,s);vue_util_1.isArray(l)?a=a.concat(l):vue_util_1.isObject(l)&&a.push(l)}return a}function iteratorNumber(t){for(var e=t.val,r=t.context,n=t.el,i=t.parentVNode,o=t.itItemStr,u=t.renderFun,a=t.VNodes,s=1;s<=e;s++){var l=iteratorVFor.call(this,{context:proxy_1.createContext(r),el:n,parentVNode:i,itItemStr:o,itItemObj:s,renderFun:u},null,s);vue_util_1.isArray(l)?a=a.concat(l):vue_util_1.isObject(l)&&a.push(l)}return a}function hasVFor(t){return util_1.hasVAttr(t,constants_1.DIRECT_PREFIX+"for")}function parseVFor(t){var e=t.context,r=t.el,n=t.parentVNode,i=t.vAttrNames,o=t.renderFun,t=r.getAttribute(constants_1.GROUP_KEY_NAME);r.hasAttribute(constants_1.GROUP_KEY_NAME)&&t||(t=vue_util_1.uuid(),r.setAttribute(constants_1.GROUP_KEY_NAME,t));i=i.find(function(t){return-1!==t.indexOf(constants_1.DIRECT_PREFIX+"for")}),i=r.getAttribute(i).split(regexp_1.EMPTY_SPLIT);if(2!==i.length)return null;for(var u=i[0].trim(),i=i[1].trim(),a=[],s=util_2.execExpression.call(this,e,i),l=0;l<ITERATOR_CHAIN.length;){if(ITERATOR_CHAIN[l].condition(s)){a=ITERATOR_CHAIN[l].handler.call(this,{val:s,context:e,el:r,parentVNode:n,itItemStr:u,renderFun:o,VNodes:a});break}l++}for(var c=this.componentsMap.keys(),_=this;c.length;)!function(){var e=c.pop();a.some(function(t){return t.key===e})||_.componentsMap.delete(e)}();return a}function iteratorVFor(t,e,r){var n=t.context,i=t.el,o=t.parentVNode,u=t.itItemStr,a=t.itItemObj,t=t.renderFun;u.startsWith("(")&&u.endsWith(")")&&-1!==(u=u.substring(1,u.length-1).trim()).indexOf(",")?(n[(c=u.split(regexp_1.COMMA_SPLIT).map(function(t){return t.trim()}))[0].trim()]=a,n[c[1].trim()]=e||r,3<=c.length&&(n[c[2].trim()]=r)):n[u]=a;var s,l,e=i.getAttributeNames(),c=i.getAttribute(constants_1.GROUP_KEY_NAME),u=i.cloneNode(!0);return-1!==e.indexOf(constants_1.DIRECT_PREFIX+"bind:key")?(s=constants_1.DIRECT_PREFIX+"bind:key",l=u.getAttribute(s),a=util_2.execExpression.call(this,n,l),u.setAttribute(s,"'"+c+"' + '("+a+")'")):e.indexOf("key")?(s="key",l=u.getAttribute(s),u.setAttribute(s,c+"("+l+")")):u.setAttribute("key",""+c+r),u.removeAttribute(constants_1.DIRECT_PREFIX+"for"),t.call(this,{context:n,el:u,parentVNode:o,parentElement:i.parentElement})}exports.hasVFor=hasVFor,exports.parseVFor=parseVFor,exports.iteratorVFor=iteratorVFor;
//# sourceMappingURL=for.js.map
