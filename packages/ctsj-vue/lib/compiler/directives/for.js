"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.iteratorVFor=exports.parseVFor=exports.hasVFor=void 0;var uuid_1=__importDefault(require("../../shared/uuid")),util_1=require("./util"),regexp_1=require("../../shared/regexp"),constants_1=require("../../shared/constants"),util_2=require("../../shared/util"),proxy_1=require("../../core/proxy"),ITERATOR_CHAIN=[{condition:function(t){return util_2.isObject(t)},handler:iteratorObj},{condition:function(t){return util_2.isArray(t)},handler:iteratorArray},{condition:function(t){return util_2.isNumber(t)},handler:iteratorNumber}];function iteratorObj(t){var e,r,n=t.val,i=t.context,o=t.el,a=t.parentVNode,s=t.itItemStr,u=t.renderFun,l=t.VNodes,c=0;for(e in n)proxy_1.isProxyProperty(e)&&(r=iteratorVFor.call(this,{context:proxy_1.createContext(i),el:o,parentVNode:a,itItemStr:s,itItemObj:n[e],renderFun:u},e,c),util_2.isArray(r)?l=l.concat(r):util_2.isObject(r)&&l.push(r),c++);return l}function iteratorArray(t){for(var e=t.val,r=t.context,n=t.el,i=t.parentVNode,o=t.itItemStr,a=t.renderFun,s=t.VNodes,u=0;u<e.length;u++){var l=iteratorVFor.call(this,{context:proxy_1.createContext(r),el:n,parentVNode:i,itItemStr:o,itItemObj:e[u],renderFun:a},null,u);util_2.isArray(l)?s=s.concat(l):util_2.isObject(l)&&s.push(l)}return s}function iteratorNumber(t){for(var e=t.val,r=t.context,n=t.el,i=t.parentVNode,o=t.itItemStr,a=t.renderFun,s=t.VNodes,u=1;u<=e;u++){var l=iteratorVFor.call(this,{context:proxy_1.createContext(r),el:n,parentVNode:i,itItemStr:o,itItemObj:u,renderFun:a},null,u);util_2.isArray(l)?s=s.concat(l):util_2.isObject(l)&&s.push(l)}return s}function hasVFor(t){return util_1.hasVAttr(t,constants_1.DIRECT_PREFIX+"for")}function parseVFor(t){var e=t.context,r=t.el,n=t.parentVNode,i=t.vAttrNames,o=t.renderFun,t=r.getAttribute(constants_1.GROUP_KEY_NAME);r.hasAttribute(constants_1.GROUP_KEY_NAME)&&t||(t=uuid_1.default(),r.setAttribute(constants_1.GROUP_KEY_NAME,t));i=i.find(function(t){return-1!==t.indexOf(constants_1.DIRECT_PREFIX+"for")}),i=r.getAttribute(i).split(regexp_1.EMPTY_SPLIT);if(2!==i.length)return null;for(var a=i[0].trim(),i=i[1].trim(),s=[],u=util_2.execExpression.call(this,e,i),l=0;l<ITERATOR_CHAIN.length;){if(ITERATOR_CHAIN[l].condition(u)){s=ITERATOR_CHAIN[l].handler.call(this,{val:u,context:e,el:r,parentVNode:n,itItemStr:a,renderFun:o,VNodes:s});break}l++}for(var c=this.componentsMap.keys(),_=this;c.length;)!function(){var e=c.pop();s.some(function(t){return t.key===e})||_.componentsMap.delete(e)}();return s}function iteratorVFor(t,e,r){var n=t.context,i=t.el,o=t.parentVNode,a=t.itItemStr,s=t.itItemObj,t=t.renderFun;a.startsWith("(")&&a.endsWith(")")&&-1!==(a=a.substring(1,a.length-1).trim()).indexOf(",")?(n[(c=a.split(regexp_1.COMMA_SPLIT).map(function(t){return t.trim()}))[0].trim()]=s,n[c[1].trim()]=e||r,3<=c.length&&(n[c[2].trim()]=r)):n[a]=s;var u,l,e=i.getAttributeNames(),c=i.getAttribute(constants_1.GROUP_KEY_NAME),a=i.cloneNode(!0);return-1!==e.indexOf(constants_1.DIRECT_PREFIX+"bind:key")?(u=constants_1.DIRECT_PREFIX+"bind:key",l=a.getAttribute(u),s=util_2.execExpression.call(this,n,l),a.setAttribute(u,"'"+c+"' + '("+s+")'")):e.indexOf("key")?(u="key",l=a.getAttribute(u),a.setAttribute(u,c+"("+l+")")):a.setAttribute("key",""+c+r),a.removeAttribute(constants_1.DIRECT_PREFIX+"for"),t.call(this,{context:n,el:a,parentVNode:o,parentElement:i.parentElement})}exports.hasVFor=hasVFor,exports.parseVFor=parseVFor,exports.iteratorVFor=iteratorVFor;
//# sourceMappingURL=for.js.map
