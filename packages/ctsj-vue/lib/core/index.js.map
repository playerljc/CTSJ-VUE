{"version":3,"file":"index.js","sources":["core/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util_1 = require(\"./component/util\");\r\nvar vdom_1 = require(\"./vdom\");\r\nvar register_1 = require(\"./component/register\");\r\nvar render_1 = require(\"../compiler/render\");\r\nvar constants_1 = require(\"../shared/constants\");\r\nvar merge_1 = require(\"./merge\");\r\nvar util_2 = require(\"./util\");\r\nvar proxy_1 = require(\"./proxy\");\r\nvar util_3 = require(\"../shared/util\");\r\n/**\r\n * findVNodeParentByKey - 查询key的Parent\r\n * @param VNode - 当前节点\r\n * @param key - 查询的key\r\n * @return {VNode}\r\n */\r\nfunction findVNodeParentByKey(VNode, key) {\r\n    if (VNode.key === key) {\r\n        return null;\r\n    }\r\n    var parent = null;\r\n    if (!('children' in VNode) || !VNode.children)\r\n        return null;\r\n    for (var i = 0; i < VNode.children.length; i++) {\r\n        var curVNode = VNode.children[i];\r\n        if (curVNode.key === key) {\r\n            parent = VNode;\r\n            break;\r\n        }\r\n        else if ('children' in curVNode && curVNode.children) {\r\n            parent = findVNodeParentByKey.call(this, curVNode, key);\r\n            if (parent)\r\n                break;\r\n        }\r\n    }\r\n    return parent;\r\n}\r\n/**\r\n * Vue\r\n * @class Vue\r\n * @classdesc Vue实例\r\n */\r\nvar Vue = /** @class */ (function () {\r\n    /**\r\n     * constructor\r\n     * @param config - Object\r\n     */\r\n    function Vue(config) {\r\n        // $config - Vue的配置对象\r\n        this.$config = config;\r\n        // 获取Vue配置中的el实际对象，el可以是HtmlElement或String\r\n        this.$config.el = util_2.getEl(this.$config.el);\r\n        // 纯净的data数据，没有进行代理的\r\n        this.$noProxySrcData = util_3.cloneDeep(util_3.isFunction(this.$config.data) ? this.$config.data() : {});\r\n        // 将data混入到this中\r\n        merge_1.mergeData.call(this);\r\n        // 将computed混入到this中\r\n        merge_1.mergeComputed.call(this);\r\n        // ------ beforeCreate\r\n        // 在实例初始化之后，数据观测 (data observer) 和 event/watcher 事件配置之前被调用。------这里是vue文档写的\r\n        util_2.triggerLifecycle.call(this, constants_1.LIFECYCLE_HOOKS[0]);\r\n        // data observer - 数据响应式创建针对data和computed的响应式\r\n        // 被响应式的数据有data | computed\r\n        this.$dataProxy = proxy_1.createVueProxy.call(this, this);\r\n        // 将methods混入到this中\r\n        merge_1.mergeMethods.call(this);\r\n        // 创建template(模板)的el对象templateEl，一个Vue实例只建立一次\r\n        this.templateEl = util_3.createElement(this.$config.template);\r\n        // 存放组件实例的Map\r\n        this.componentsMap = new Map();\r\n        // 渲染\r\n        render_1.render.call(this, this.$config.el, true);\r\n    }\r\n    /**\r\n     * component - 全局注册组件(在任何地方都可以使用)\r\n     * @param componentName - string 注册的组件名称\r\n     *          分为 kebab-case(xxx-xxx-xxx) PascalCase(AbcDef) 两种的形式\r\n     *          如果使用kebab-case进行的注册 则只能使用kebab-case进行使用\r\n     *          如果使用PascalCase进行的注册 则使用kebab-case和PascalCase都可以\r\n     *          例：\r\n     *          注册：Vue.component('my-component',{});\r\n     *          使用：<my-component>\r\n     *\r\n     *          注册 Vue.component('MyComponent',{});\r\n     *          使用 <my-component> 或 <MyComponent>\r\n     * @param config - Object 组件的配置\r\n     */\r\n    Vue.component = function (componentName, config) {\r\n        // 使用kebab-case进行注册(xxx-xxx-xxx) componentName需要转换成小写 xxx-xxx-xxx不变\r\n        if (util_1.isKebabCase(componentName)) {\r\n            register_1.register(componentName.toLowerCase(), config);\r\n        }\r\n        // 使用PascalCase进行注册(AbcDef) componentName需要转换成小写 XxxXxx转换成xxxxxx\r\n        else if (util_1.isPascalCase(componentName)) {\r\n            // 使用xxxxxx进行注册\r\n            register_1.register(componentName.toLowerCase(), config);\r\n            // 使用xxx-xxx-xxx进行注册\r\n            register_1.register(util_1.pascalCaseToKebabCase(componentName), config);\r\n        }\r\n    };\r\n    /**\r\n     * createAsyncExecContext - 创建一个异步的执行上下文\r\n     * @param callBack - Function 回调的函数\r\n     * @return Function\r\n     */\r\n    Vue.prototype.createAsyncExecContext = function (callBack) {\r\n        var self = this;\r\n        return function () {\r\n            util_3.createExecutionContext.call(self, self, callBack);\r\n        };\r\n    };\r\n    /**\r\n     * refresh - 指定VNode刷新\r\n     * @param VNode\r\n     */\r\n    Vue.prototype.refresh = function (VNode) {\r\n        // this.$preVNode\r\n        var cloneNode = util_3.cloneDeep(this.$preVNode);\r\n        var parent = findVNodeParentByKey.call(this, cloneNode, VNode.key);\r\n        if (parent) {\r\n            var index = parent.children.findIndex(function (node) { return node.key === VNode.key; });\r\n            if (index !== -1) {\r\n                parent.children[index] = VNode;\r\n                this.$preVNode = vdom_1.patch(this.$preVNode, cloneNode);\r\n            }\r\n        }\r\n    };\r\n    return Vue;\r\n}());\r\nexports.default = Vue;\r\n"],"names":["Object","defineProperty","exports","value","util_1","require","vdom_1","register_1","render_1","constants_1","merge_1","util_2","proxy_1","util_3","findVNodeParentByKey","VNode","key","parent","children","i","length","curVNode","call","this","Vue","config","$config","el","getEl","$noProxySrcData","cloneDeep","isFunction","data","mergeData","mergeComputed","triggerLifecycle","LIFECYCLE_HOOKS","$dataProxy","createVueProxy","mergeMethods","templateEl","createElement","template","componentsMap","Map","render","component","componentName","isKebabCase","register","toLowerCase","isPascalCase","pascalCaseToKebabCase","prototype","createAsyncExecContext","callBack","self","createExecutionContext","refresh","index","cloneNode","$preVNode","findIndex","node","patch","default"],"mappings":"aACAA,OAAOC,eAAeC,QAAS,aAAc,CAAEC,OAAO,IACtD,IAAIC,OAASC,QAAQ,oBACjBC,OAASD,QAAQ,UACjBE,WAAaF,QAAQ,wBACrBG,SAAWH,QAAQ,sBACnBI,YAAcJ,QAAQ,uBACtBK,QAAUL,QAAQ,WAClBM,OAASN,QAAQ,UACjBO,QAAUP,QAAQ,WAClBQ,OAASR,QAAQ,kBAOrB,SAASS,qBAAqBC,EAAOC,GACjC,GAAID,EAAMC,MAAQA,EACd,OAAO,KAEX,IAAIC,EAAS,KACb,KAAM,aAAcF,GAAWA,EAAMG,UACjC,OAAO,KACX,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAMG,SAASE,OAAQD,IAAK,CAC5C,IAAIE,EAAWN,EAAMG,SAASC,GAC9B,GAAIE,EAASL,MAAQA,EAAK,CACtBC,EAASF,EACT,MAEC,GAAI,aAAcM,GAAYA,EAASH,WACxCD,EAASH,qBAAqBQ,KAAKC,KAAMF,EAAUL,IAE/C,MAGZ,OAAOC,EAOX,IAAIO,IAAqB,WAKrB,SAASA,EAAIC,GAETF,KAAKG,QAAUD,EAEfF,KAAKG,QAAQC,GAAKhB,OAAOiB,MAAML,KAAKG,QAAQC,IAE5CJ,KAAKM,gBAAkBhB,OAAOiB,UAAUjB,OAAOkB,WAAWR,KAAKG,QAAQM,MAAQT,KAAKG,QAAQM,OAAS,IAErGtB,QAAQuB,UAAUX,KAAKC,MAEvBb,QAAQwB,cAAcZ,KAAKC,MAG3BZ,OAAOwB,iBAAiBb,KAAKC,KAAMd,YAAY2B,gBAAgB,IAG/Db,KAAKc,WAAazB,QAAQ0B,eAAehB,KAAKC,KAAMA,MAEpDb,QAAQ6B,aAAajB,KAAKC,MAE1BA,KAAKiB,WAAa3B,OAAO4B,cAAclB,KAAKG,QAAQgB,UAEpDnB,KAAKoB,cAAgB,IAAIC,IAEzBpC,SAASqC,OAAOvB,KAAKC,KAAMA,KAAKG,QAAQC,IAAI,GAwDhD,OAxCAH,EAAIsB,UAAY,SAAUC,EAAetB,GAEjCrB,OAAO4C,YAAYD,GACnBxC,WAAW0C,SAASF,EAAcG,cAAezB,GAG5CrB,OAAO+C,aAAaJ,KAEzBxC,WAAW0C,SAASF,EAAcG,cAAezB,GAEjDlB,WAAW0C,SAAS7C,OAAOgD,sBAAsBL,GAAgBtB,KAQzED,EAAI6B,UAAUC,uBAAyB,SAAUC,GAC7C,IAAIC,EAAOjC,KACX,OAAO,WACHV,OAAO4C,uBAAuBnC,KAAKkC,EAAMA,EAAMD,KAOvD/B,EAAI6B,UAAUK,QAAU,SAAU3C,GAE9B,IAGQ4C,EAHJC,EAAY/C,OAAOiB,UAAUP,KAAKsC,WAClC5C,EAASH,qBAAqBQ,KAAKC,KAAMqC,EAAW7C,EAAMC,MAC1DC,IAEe,KADX0C,EAAQ1C,EAAOC,SAAS4C,UAAU,SAAUC,GAAQ,OAAOA,EAAK/C,MAAQD,EAAMC,SAE9EC,EAAOC,SAASyC,GAAS5C,EACzBQ,KAAKsC,UAAYvD,OAAO0D,MAAMzC,KAAKsC,UAAWD,KAInDpC,EArFa,GAuFxBtB,QAAQ+D,QAAUzC"}