{"version":3,"file":"util.js","sources":["core/util.js"],"sourcesContent":["\"use strict\";\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.mixinConfig = exports.isComputedProperty = exports.isVueInstance = exports.getEl = exports.triggerLifecycle = exports.resetComputed = void 0;\r\nvar util_1 = require(\"./component/util\");\r\nvar util_2 = require(\"../shared/util\");\r\nvar constants_1 = require(\"../shared/constants\");\r\nvar index_1 = __importDefault(require(\"./index\"));\r\n/**\r\n * resetComputed - 重置计算属性\r\n */\r\nfunction resetComputed() {\r\n    for (var p in this.$config.computed) {\r\n        this[p] = null;\r\n    }\r\n}\r\nexports.resetComputed = resetComputed;\r\n/**\r\n * triggerLifecycle - 调用生命周期函数\r\n * @param hookName\r\n */\r\nfunction triggerLifecycle(hookName) {\r\n    if (this.$config[hookName] && util_2.isArray(this.$config[hookName])) {\r\n        // 生命周期调用后，生命周期函数中的this是代理对象，因为在生命周期函数中可能(肯定)会修改data中的值\r\n        // TODO: 调用生命周期HOOKS\r\n        util_2.createExecutionContext.call(this, this, function () {\r\n            // 在一个执行上下文中调用所有的生命周期hook\r\n            var self = this;\r\n            (self.$config[hookName] || []).forEach(function (hookHandler) {\r\n                hookHandler.call(self.$dataProxy);\r\n            });\r\n            // this.$config[hookName].call(this.$dataProxy);\r\n        });\r\n    }\r\n}\r\nexports.triggerLifecycle = triggerLifecycle;\r\n/**\r\n * getEl - 根据Vue实例配置中的el获取实际的el对象\r\n * 因为VNode渲染的原因它会替换掉原始的el节点，所以要自己创建一个渲染子节点用来被替换\r\n * @param elConfig - HtmlElement | String\r\n * @return HTMLElement\r\n */\r\nfunction getEl(elConfig) {\r\n    var el;\r\n    if (elConfig instanceof HTMLElement) {\r\n        el = elConfig;\r\n    }\r\n    else if (typeof elConfig === 'string') {\r\n        el = document.querySelector(elConfig);\r\n    }\r\n    return el;\r\n    // if(el) {\r\n    //   const innerEl = document.createElement('div');\r\n    //   el.appendChild(innerEl);\r\n    //   return innerEl;\r\n    // }\r\n    //\r\n    // return null;\r\n}\r\nexports.getEl = getEl;\r\n/**\r\n * isVueInstance - ins是否是一个Vue实例\r\n * @param ins - 一个实例对象\r\n * @return boolean\r\n */\r\nfunction isVueInstance(ins) {\r\n    return util_2.isObject(ins) && ins instanceof index_1.default;\r\n}\r\nexports.isVueInstance = isVueInstance;\r\n/**\r\n * isComputedProperty - 是否是计算属性的key\r\n * @param ins - 实例\r\n * @param key - key\r\n * @return boolean\r\n */\r\nfunction isComputedProperty(ins, key) {\r\n    if (isVueInstance(ins)) {\r\n        return key in (ins.$config.computed || {});\r\n    }\r\n    if (util_1.isComponentInstance(ins)) {\r\n        return key in (ins.$config.computed || {});\r\n    }\r\n    return false;\r\n}\r\nexports.isComputedProperty = isComputedProperty;\r\n/**\r\n * mixinConfig 配置对象的混入\r\n * @param globalConfig Object 全局配置对象\r\n * @param mixins Array 实例(vue或component)的mixin\r\n * @param config Object 实例的配置对象本身\r\n * @return Object 实际的配置对象\r\n * 注：\r\n * .生命周期函数会放在一个数组里，按照目标->mixin->全局的顺序输出\r\n * .其他都是替换 替换的顺序是 ~ 组件->mixin->全局\r\n */\r\nfunction mixinConfig(_a) {\r\n    // 先处理生命周期钩子\r\n    // 在处理mixin\r\n    var _b = _a.globalConfig, globalConfig = _b === void 0 ? {} : _b, _c = _a.mixins, mixins = _c === void 0 ? [] : _c, _d = _a.config, config = _d === void 0 ? {} : _d;\r\n    // 所有的配置对象，这个顺序是不能变的\r\n    var configs = __spreadArrays([globalConfig || {}], (mixins || []), [config || {}]);\r\n    // 生命周期\r\n    var lifeCycle = {};\r\n    // 迭代所有配置对象\r\n    configs.forEach(function (c) {\r\n        // 获取一个配置对象的所有属性\r\n        var keys = Object.keys(c);\r\n        // 迭代一个配置对象的属性\r\n        for (var i = 0; i < keys.length; i++) {\r\n            var key = keys[i];\r\n            // 是一个生命周期的属性\r\n            if (constants_1.LIFECYCLE_HOOKS.indexOf(key) !== -1) {\r\n                // 如果没有创建一个数组\r\n                if (!lifeCycle[key]) {\r\n                    lifeCycle[key] = [];\r\n                }\r\n                lifeCycle[key].push(c[key]);\r\n            }\r\n        }\r\n    });\r\n    return Object.assign.apply(Object, __spreadArrays([{}], configs, [lifeCycle]));\r\n}\r\nexports.mixinConfig = mixinConfig;\r\n"],"names":["__spreadArrays","this","s","i","il","arguments","length","r","Array","k","a","j","jl","__importDefault","mod","__esModule","default","Object","defineProperty","exports","value","mixinConfig","isComputedProperty","isVueInstance","getEl","triggerLifecycle","resetComputed","util_1","require","util_2","constants_1","index_1","p","$config","computed","hookName","isArray","createExecutionContext","call","self","forEach","hookHandler","$dataProxy","elConfig","el","HTMLElement","document","querySelector","ins","isObject","key","isComponentInstance","_a","_b","globalConfig","_c","mixins","_d","config","configs","lifeCycle","c","keys","LIFECYCLE_HOOKS","indexOf","push","assign","apply"],"mappings":"aACA,IAAIA,eAAkBC,MAAQA,KAAKD,gBAAmB,WAClD,IAAK,IAAIE,EAAI,EAAGC,EAAI,EAAGC,EAAKC,UAAUC,OAAQH,EAAIC,EAAID,IAAKD,GAAKG,UAAUF,GAAGG,OAC7E,IAAK,IAAIC,EAAIC,MAAMN,GAAIO,EAAI,EAAGN,EAAI,EAAGA,EAAIC,EAAID,IACzC,IAAK,IAAIO,EAAIL,UAAUF,GAAIQ,EAAI,EAAGC,EAAKF,EAAEJ,OAAQK,EAAIC,EAAID,IAAKF,IAC1DF,EAAEE,GAAKC,EAAEC,GACjB,OAAOJ,GAEPM,gBAAmBZ,MAAQA,KAAKY,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAEE,QAAWF,IAExDG,OAAOC,eAAeC,QAAS,aAAc,CAAEC,OAAO,IACtDD,QAAQE,YAAcF,QAAQG,mBAAqBH,QAAQI,cAAgBJ,QAAQK,MAAQL,QAAQM,iBAAmBN,QAAQO,mBAAgB,EAC9I,IAAIC,OAASC,QAAQ,oBACjBC,OAASD,QAAQ,kBACjBE,YAAcF,QAAQ,uBACtBG,QAAUlB,gBAAgBe,QAAQ,YAItC,SAASF,gBACL,IAAK,IAAIM,KAAK/B,KAAKgC,QAAQC,SACvBjC,KAAK+B,GAAK,KAQlB,SAASP,iBAAiBU,GAClBlC,KAAKgC,QAAQE,IAAaN,OAAOO,QAAQnC,KAAKgC,QAAQE,KAGtDN,OAAOQ,uBAAuBC,KAAKrC,KAAMA,KAAM,WAE3C,IAAIsC,EAAOtC,MACVsC,EAAKN,QAAQE,IAAa,IAAIK,QAAQ,SAAUC,GAC7CA,EAAYH,KAAKC,EAAKG,gBAatC,SAASlB,MAAMmB,GACX,IAAIC,EAOJ,OANID,aAAoBE,YACpBD,EAAKD,EAEoB,iBAAbA,IACZC,EAAKE,SAASC,cAAcJ,IAEzBC,EAeX,SAASrB,cAAcyB,GACnB,OAAOnB,OAAOoB,SAASD,IAAQA,aAAejB,QAAQf,QAS1D,SAASM,mBAAmB0B,EAAKE,GAC7B,OAAI3B,cAAcyB,MAGdrB,OAAOwB,oBAAoBH,KAFpBE,KAAQF,EAAIf,QAAQC,UAAY,IAkB/C,SAASb,YAAY+B,GAGjB,IAAIC,EAAKD,EAAGE,aAAcA,OAAsB,IAAPD,EAAgB,GAAKA,EAAIE,EAAKH,EAAGI,OAAQA,OAAgB,IAAPD,EAAgB,GAAKA,EAAIE,EAAKL,EAAGM,OAExHC,EAAU3D,eAAe,CAACsD,GAAgB,IAAME,GAAU,GAAK,OAFiF,IAAPC,EAAgB,GAAKA,IAEpF,KAE1EG,EAAY,GAkBhB,OAhBAD,EAAQnB,QAAQ,SAAUqB,GAItB,IAFA,IAAIC,EAAO7C,OAAO6C,KAAKD,GAEd1D,EAAI,EAAGA,EAAI2D,EAAKxD,OAAQH,IAAK,CAClC,IAAI+C,EAAMY,EAAK3D,IAEmC,IAA9C2B,YAAYiC,gBAAgBC,QAAQd,KAE/BU,EAAUV,KACXU,EAAUV,GAAO,IAErBU,EAAUV,GAAKe,KAAKJ,EAAEX,QAI3BjC,OAAOiD,OAAOC,MAAMlD,OAAQjB,eAAe,CAAC,IAAK2D,EAAS,CAACC,KAxGtEzC,QAAQO,cAAgBA,cAmBxBP,QAAQM,iBAAmBA,iBAwB3BN,QAAQK,MAAQA,MAShBL,QAAQI,cAAgBA,cAgBxBJ,QAAQG,mBAAqBA,mBAsC7BH,QAAQE,YAAcA"}