"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var s in e=arguments[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var vue_util_1=require("@ctsj/vue-util"),regexp_1=require("../../shared/regexp"),on_1=require("../../compiler/directives/on"),renderComponent_1=require("../../compiler/renderComponent"),proxy_1=require("../proxy"),util_1=require("../../shared/util"),util_2=require("./util"),merge_1=require("../merge"),util_3=require("../util"),index_1=require("../index"),constants_1=require("../../shared/constants"),proxyDirtyStack_1=__importDefault(require("../../compiler/proxyDirtyStack"));function getPropsAndAttrs(){var t,r=this.$argConfig.attrs,i=vue_util_1.cloneDeep(this.$config.props)||[],s={},o={};return(vue_util_1.isObject(i)||vue_util_1.isArray(i))&&(vue_util_1.isObject(i)&&(i=Object.keys(i)),(t=this.$config.model)&&"value"in r?i.includes(t.prop)||(i.push(t.prop),r[t.prop]=r.value,delete r.value):"value"in r&&!i.includes("value")&&i.push("value")),Object.keys(r).forEach(function(e){var t=i.findIndex(function(t){return util_1.pascalCaseToKebabCase(t)===e});-1!==t?s[i[t]]=r[e]:o[e]=r[e]}),{props:s,attrs:o}}function createEmit(){var o=this;return function(t){for(var e=o.$argConfig.events,r=[],i=0;i<arguments.length;i++)0===i&&t||r.push(arguments[i]);var s=t.toLowerCase();if(!(s in e))return!1;on_1.executeExecutionContextVOn.call(o.$parent,{context:{},entry:{expression:e[s]},argv:r})}}var Component=function(){function t(t,e){var r=e.key,i=e.el,s=e.root,o=e.parent,n=e.route,e=e.$route;this.$el=i,this.$root=s,this.$parent=o,this.$key=r,this.$router=this.$root.$router,this.$matchRoute=n,this.$route=e,this.$config=this.$getConfig(),this.$proxyDirtyStack=new proxyDirtyStack_1.default,this.$argConfig=t,this.$emit=createEmit.call(this),this.$refs={};e=getPropsAndAttrs.call(this),t=e.props,e=e.attrs;this.$attes=e,this.$props=vue_util_1.cloneDeep(t),this.$propsProxy=proxy_1.createPropsProxy.call(this,this.$props),this.$noProxySrcData=__assign(__assign({},this.$props),vue_util_1.cloneDeep(vue_util_1.isFunction(this.$config.data)?this.$config.data():{})),merge_1.mergeData.call(this),merge_1.mergeComputed.call(this),util_3.triggerLifecycle.call(this,constants_1.LIFECYCLE_HOOKS[0]),this.$dataProxy=proxy_1.createComponentProxy.call(this,this),merge_1.mergeProps.call(this,this.$props),merge_1.mergeMethods.call(this),util_2.inject.call(this),merge_1.mergeRouterHooks.call(this),this.templateEl=vue_util_1.createElement(this.$config.template),this.componentsMap=new Map}return t.prototype.$assignClassAndStyle=function(e){var t=this.$argConfig.attrs;t.class&&(vue_util_1.isObject(t.class)?Object.assign(e.data.class,t.class):vue_util_1.isString(t.class)&&t.class.trim().split(regexp_1.CLASSNAME_SPLIT).forEach(function(t){e.data.class[t]=!0})),t.style&&(vue_util_1.isObject(t.style)?Object.assign(e.data.style,t.style):vue_util_1.isString(t.style)&&t.style.split(regexp_1.STYLE_RULE_SPLIT).filter(function(t){return t}).forEach(function(t){t=t.split(regexp_1.STYLE_RULE_ENTRY_SPLIT).filter(function(t){return t});e.data.style[t[0]]=t[1]}))},t.prototype.$setParams=function(t){this.$argConfig=t},t.prototype.$getConfig=function(){var t=util_2.getComponentConfig(this.$parent,this.$el.tagName.toLowerCase());return util_3.mixinConfig({globalConfig:index_1.getGlobalConfig(),mixins:t.mixins||[],config:t})},t.prototype.$getComponentsConfig=function(){var e=this.$getConfig();if(!(e&&"components"in e&&e.components))return{};var r={};return Object.keys(e.components).forEach(function(t){util_1.isKebabCase(t)?r[t.toLowerCase()]=e.components[t]:util_1.isPascalCase(t)&&(r[t.toLowerCase()]=e.components[t],r[util_1.pascalCaseToKebabCase(t)]=e.components[t])}),r},t.prototype.$getParentContext=function(){return this.$argConfig.parentContext},t.prototype.$createAsyncExecContext=function(t){var e=this;return function(){util_1.createExecutionContext.call(e,e,t)}},t.prototype.$render=function(){var t=renderComponent_1.renderComponent.call(this);return this.$assignClassAndStyle(t),t.key=this.$key,t},t.prototype.$update=function(){var e=this,t=getPropsAndAttrs.call(this),r=t.props,t=t.attrs;this.$attes=t;t=Object.keys(this.$props);this.$props=vue_util_1.cloneDeep(r),Object.assign(this.$propsProxy,this.$props),t.forEach(function(t){t in e.$noProxySrcData&&delete e.$noProxySrcData[t],t in e&&delete e[t]}),Object.assign(this.$noProxySrcData,this.$props),merge_1.mergeProps.call(this,this.$props),this.$propsProxy=proxy_1.createPropsProxy.call(this,this.$props),util_3.resetComputed.call(this);t=renderComponent_1.renderComponent.call(this);return this.$assignClassAndStyle(t),t.key=this.$key,t},t}();exports.default=Component;
//# sourceMappingURL=index.js.map
