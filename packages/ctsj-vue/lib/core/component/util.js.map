{"version":3,"file":"util.js","sources":["core/component/util.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.inject = exports.isComponentInstance = exports.getComponentConfig = exports.createComponent = exports.isComponentNodeByComponent = exports.isComponentNodeByVue = void 0;\r\nvar vue_util_1 = require(\"@ctsj/vue-util\");\r\nvar register_1 = require(\"./register\");\r\nvar util_1 = require(\"../util\");\r\nvar util_2 = require(\"../../shared/util\");\r\nvar index_1 = __importDefault(require(\"./index\"));\r\n/**\r\n * isComponentNodeByVue - 在Vue实例下el是否为一个组件标签\r\n * @param el - {HtmlElement}\r\n * @return boolean\r\n */\r\nfunction isComponentNodeByVue(el) {\r\n    // 是否是Element元素\r\n    var isElement = vue_util_1.isElementNode(el);\r\n    if (!isElement)\r\n        return false;\r\n    var tagName = el.tagName;\r\n    return register_1.existsComponentByGlobal(tagName.toLowerCase());\r\n}\r\nexports.isComponentNodeByVue = isComponentNodeByVue;\r\n/**\r\n * isComponentNodeByComponent - 在component实例下el是否是组件标签\r\n * @param el - {HtmlElement}\r\n * @param components - 组件配置中的components声明\r\n * @return boolean\r\n */\r\nfunction isComponentNodeByComponent(el, components) {\r\n    // 是否是Element元素\r\n    var isElement = vue_util_1.isElementNode(el);\r\n    if (!isElement)\r\n        return false;\r\n    var tagName = el.tagName;\r\n    var exists = register_1.existsComponentByComponent(tagName.toLowerCase(), components);\r\n    // 如果在组件的components中没有找到则去全局中寻找\r\n    if (!exists) {\r\n        exists = register_1.existsComponentByGlobal(tagName.toLowerCase());\r\n    }\r\n    return exists;\r\n}\r\nexports.isComponentNodeByComponent = isComponentNodeByComponent;\r\n/**\r\n * createComponent - 创建一个组件(Component)\r\n * @param attrs - Object props和attrs的所有k/v数据\r\n * @param events - Object 所有events的k/v数据\r\n * @param parentContext - Object 父亲的上下文对象\r\n * @param parent - Vue | Component 父亲是Vue实例或者Component实例\r\n * @param root - Vue Vue实例\r\n * @param el - HtmlElement 元素\r\n * @param key - string 组件的key\r\n * @param route - Object 匹配的路由配置\r\n * @param $route - Object 当前理由信息\r\n * @return Component\r\n */\r\nfunction createComponent(_a) {\r\n    var attrs = _a.attrs, events = _a.events, parentContext = _a.parentContext, parent = _a.parent, root = _a.root, el = _a.el, key = _a.key, route = _a.route, $route = _a.$route;\r\n    return new index_1.default({ attrs: attrs, events: events, parentContext: parentContext }, { key: key, el: el, root: root, parent: parent, route: route, $route: $route });\r\n}\r\nexports.createComponent = createComponent;\r\n/**\r\n * getComponentConfig - 获取组件的配置对象\r\n * @param ins - Vue | Component vue或component实例\r\n * @param componentName - 组件的名字\r\n * @return Object 组件的配置对象\r\n */\r\n// xxx-xxx-xxx 获取\r\n// AbcDef 尝试AbcDef和abc-def获取\r\nfunction getComponentConfig(ins, componentName) {\r\n    // 如果是Vue实例\r\n    if (util_1.isVueInstance(ins)) {\r\n        // 需要判断是否有mixin\r\n        return register_1.getConfig(componentName);\r\n    }\r\n    // 如果是组件实例\r\n    if (isComponentInstance(ins)) {\r\n        var components = ins.$getComponentsConfig();\r\n        // 如果组件的components中定义了\r\n        if (components[componentName]) {\r\n            return components[componentName];\r\n        }\r\n        // 如果组件的components没有定义则去全局寻找\r\n        // 需要判断是否有mixin\r\n        return register_1.getConfig(componentName);\r\n    }\r\n    return null;\r\n}\r\nexports.getComponentConfig = getComponentConfig;\r\n/**\r\n * isComponentInstance - ins是否是一个组件实例\r\n * @param ins - 一个实例对象\r\n * @return boolean\r\n */\r\nfunction isComponentInstance(ins) {\r\n    return vue_util_1.isObject(ins) && ins instanceof index_1.default;\r\n}\r\nexports.isComponentInstance = isComponentInstance;\r\n/**\r\n * findProviderHasMethodInsByName - 在provider中查找是否含有methodName的属性\r\n * @param methodName\r\n * @return {any}\r\n */\r\nfunction findProviderHasMethodInsByName(methodName) {\r\n    var ins = this.$parent;\r\n    while (ins) {\r\n        if ('provider' in ins.$config && vue_util_1.isFunction(ins.$config.provider)) {\r\n            // 获取provider对象\r\n            var provider = ins.$config.provider.call(ins);\r\n            // 如果methodName在provider中且类型是Function\r\n            if (methodName in provider && vue_util_1.isFunction(provider[methodName])) {\r\n                break;\r\n            }\r\n        }\r\n        ins = ins.$parent;\r\n    }\r\n    return ins;\r\n}\r\n/**\r\n * inject - 处理依赖注入\r\n * @return boolean\r\n */\r\nfunction inject() {\r\n    var _this = this;\r\n    if (!('inject' in this.$config) || !vue_util_1.isArray(this.$config.inject))\r\n        return false;\r\n    // 获取配置中的inject属性\r\n    var _a = this.$config.inject, inject = _a === void 0 ? [] : _a;\r\n    // inject: ['getMap','display','setPage']\r\n    // 迭代inject属性(是一个数组)\r\n    // {{display()}}\r\n    inject.forEach(function (methodName) {\r\n        var ins = findProviderHasMethodInsByName.call(_this, methodName);\r\n        if (ins) {\r\n            var provider_1 = ins.$config.provider.call(ins);\r\n            _this[methodName] = function () {\r\n                // provider[methodName].bind(ins);\r\n                return util_2.createExecutionContext.call(ins, ins, function () {\r\n                    return provider_1[methodName].apply(ins.$dataProxy, Array.from(arguments));\r\n                });\r\n            };\r\n        }\r\n    });\r\n    return true;\r\n}\r\nexports.inject = inject;\r\n"],"names":["__importDefault","this","mod","__esModule","default","Object","defineProperty","exports","value","inject","isComponentInstance","getComponentConfig","createComponent","isComponentNodeByComponent","isComponentNodeByVue","vue_util_1","require","register_1","util_1","util_2","index_1","el","isElementNode","tagName","existsComponentByGlobal","toLowerCase","components","existsComponentByComponent","_a","attrs","events","parentContext","parent","root","key","route","$route","ins","componentName","isVueInstance","getConfig","$getComponentsConfig","isObject","findProviderHasMethodInsByName","methodName","$parent","$config","isFunction","provider","call","_this","isArray","forEach","provider_1","createExecutionContext","apply","$dataProxy","Array","from","arguments"],"mappings":"aACA,IAAIA,gBAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAEE,QAAWF,IAExDG,OAAOC,eAAeC,QAAS,aAAc,CAAEC,OAAO,IACtDD,QAAQE,OAASF,QAAQG,oBAAsBH,QAAQI,mBAAqBJ,QAAQK,gBAAkBL,QAAQM,2BAA6BN,QAAQO,0BAAuB,EAC1K,IAAIC,WAAaC,QAAQ,kBACrBC,WAAaD,QAAQ,cACrBE,OAASF,QAAQ,WACjBG,OAASH,QAAQ,qBACjBI,QAAUpB,gBAAgBgB,QAAQ,YAMtC,SAASF,qBAAqBO,GAG1B,IADgBN,WAAWO,cAAcD,GAErC,OAAO,EACPE,EAAUF,EAAGE,QACjB,OAAON,WAAWO,wBAAwBD,EAAQE,eAStD,SAASZ,2BAA2BQ,EAAIK,GAGpC,IADgBX,WAAWO,cAAcD,GAErC,OAAO,EACPE,EAAUF,EAAGE,QAMjB,OALaN,WAAWU,2BAA2BJ,EAAQE,cAAeC,IAG7DT,WAAWO,wBAAwBD,EAAQE,eAkB5D,SAASb,gBAAgBgB,GACrB,IAAIC,EAAQD,EAAGC,MAAOC,EAASF,EAAGE,OAAQC,EAAgBH,EAAGG,cAAeC,EAASJ,EAAGI,OAAQC,EAAOL,EAAGK,KAAMZ,EAAKO,EAAGP,GAAIa,EAAMN,EAAGM,IAAKC,EAAQP,EAAGO,MAAOC,EAASR,EAAGQ,OACxK,OAAO,IAAIhB,QAAQhB,QAAQ,CAAEyB,MAAOA,EAAOC,OAAQA,EAAQC,cAAeA,GAAiB,CAAEG,IAAKA,EAAKb,GAAIA,EAAIY,KAAMA,EAAMD,OAAQA,EAAQG,MAAOA,EAAOC,OAAQA,IAWrK,SAASzB,mBAAmB0B,EAAKC,GAE7B,GAAIpB,OAAOqB,cAAcF,GAErB,OAAOpB,WAAWuB,UAAUF,GAGhC,GAAI5B,oBAAoB2B,GAAM,CACtBX,EAAaW,EAAII,uBAErB,OAAIf,EAAWY,GACJZ,EAAWY,GAIfrB,WAAWuB,UAAUF,GAEhC,OAAO,KAQX,SAAS5B,oBAAoB2B,GACzB,OAAOtB,WAAW2B,SAASL,IAAQA,aAAejB,QAAQhB,QAQ9D,SAASuC,+BAA+BC,GAEpC,IADA,IAAIP,EAAMpC,KAAK4C,QACRR,GAAK,CACR,GAAI,aAAcA,EAAIS,SAAW/B,WAAWgC,WAAWV,EAAIS,QAAQE,UAAW,CAE1E,IAAIA,EAAWX,EAAIS,QAAQE,SAASC,KAAKZ,GAEzC,GAAIO,KAAcI,GAAYjC,WAAWgC,WAAWC,EAASJ,IACzD,MAGRP,EAAMA,EAAIQ,QAEd,OAAOR,EAMX,SAAS5B,SACL,IAAIyC,EAAQjD,KACZ,KAAM,WAAYA,KAAK6C,SAAa/B,WAAWoC,QAAQlD,KAAK6C,QAAQrC,SAChE,OAAO,EAEX,IAAImB,EAAK3B,KAAK6C,QAAQrC,OAgBtB,YAhB8C,IAAPmB,EAAgB,GAAKA,GAIrDwB,QAAQ,SAAUR,GACrB,IAEQS,EAFJhB,EAAMM,+BAA+BM,KAAKC,EAAON,GACjDP,IACIgB,EAAahB,EAAIS,QAAQE,SAASC,KAAKZ,GAC3Ca,EAAMN,GAAc,WAEhB,OAAOzB,OAAOmC,uBAAuBL,KAAKZ,EAAKA,EAAK,WAChD,OAAOgB,EAAWT,GAAYW,MAAMlB,EAAImB,WAAYC,MAAMC,KAAKC,mBAKxE,EAzHXpD,QAAQO,qBAAuBA,qBAoB/BP,QAAQM,2BAA6BA,2BAkBrCN,QAAQK,gBAAkBA,gBA4B1BL,QAAQI,mBAAqBA,mBAS7BJ,QAAQG,oBAAsBA,oBAgD9BH,QAAQE,OAASA"}